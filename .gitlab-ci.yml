image: docker:latest
services:
    - docker:dind

stages:
    - deploy

deploy-prod:
    stage: deploy
    only:
        - master
    script:
        - apt-get install -y python-pip
        - pip install docker-compose
        - docker image prune -f
        - docker-compose -f docker-compose.yml build --no-cache
        - docker-compose -f docker-compose.yml up -d
